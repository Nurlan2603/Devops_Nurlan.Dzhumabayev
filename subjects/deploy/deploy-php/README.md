# deploy-php

–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–∞–Ω–≥–ª. "Deploy") - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –µ–≥–æ –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫.
–û—Å–Ω–æ–≤–Ω–∞—è –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å DevOps –∏–Ω–∂–µ–Ω–µ—Ä–∞ - —ç—Ç–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω–æ–≥–æ —Ä–æ–¥–∞ —Å–µ—Ä–≤–∏—Å–æ–≤.
–°–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

–í —ç—Ç–æ–π –º–æ–¥—É–ª–µ –º—ã —Ä–∞–∑–±–µ—Ä–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

–õ—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö. –≠—Ç–æ –¥–∞–µ—Ç –±–æ–ª—å—à–æ–µ
–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ, —Ç–∞–∫ –∫–∞–∫:

- –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É;
- –æ–±—Ä–∞–∑ –ø—Ä–æ–µ–∫—Ç–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–µ—Ä–µ, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `docker build` –∏–ª–∏ `docker pull`;
- –ø–æ–¥ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π —Å–µ—Ä–≤–∏—Å –º–æ–∂–Ω–æ –º–∞—Å—à–∞–±–∏—Ä–æ–≤–∞—Ç—å, –∑–∞–ø—É—Å—Ç–∏–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã-—Ä–µ–ø–ª–∏–∫–∏.

## PHP

PHP - —ç—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–π —Å–∫—Ä–∏–ø—Ç–æ–≤—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

–Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (–Ø–ü) –¥–µ–ª—è—Ç—Å—è –Ω–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–µ –∏ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–µ.
–ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–µ –Ø–ü –≤—Å–µ–≥–¥–∞ —è–≤–ª—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –≤ –ø–ª–∞–Ω–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞. –û–¥–Ω–∞–∫–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–µ
—è–∑—ã–∫–∏ –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—è –∏—Ö –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–¥ –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥.

–û—Å–Ω–æ–≤–Ω—ã–º –ø–∞–∫–µ—Ç–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –≤ PHP —è–≤–ª—è–µ—Ç—Å—è [Composer](https://getcomposer.org/). –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
–æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ composer.json ([–ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞](https://gist.github.com/mortenson/a5390d99013b5b8c0254081e89bb4d47)).

–û—Ç–¥–µ–ª—å–Ω–æ–π —Ç–µ–º–æ–π –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ø–ü –ø—Ä–æ–µ–∫—Ç–∞ —è–≤–ª—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –õ—é–±–æ–π –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Å–µ—Ç —Å —Å–æ–±–æ–π –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª.

–ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º
–º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–∞–∫–∂–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î (–Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö, –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã, —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Ç.–¥.), —Ç–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### –ü–æ–ª–µ–∑–Ω–æ–µ

- [How to Install PHP 8](https://linuxize.com/post/how-to-install-php-8-on-ubuntu-20-04/)
- [PHP FastCGI Example](https://www.nginx.com/resources/wiki/start/topics/examples/phpfcgi/)
- [Composer –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö](https://habr.com/ru/post/439200/)
- [PHP-FPM: Configuration the Listen Directive](https://serversforhackers.com/c/php-fpm-configuration-the-listen-directive)
- [Understanding and Implementing FastCGI Proxying in Nginx](https://www.digitalocean.com/community/tutorials/understanding-and-implementing-fastcgi-proxying-in-nginx)
- [Docker: configure tzdata and timezone during build](https://rtfm.co.ua/en/docker-configure-tzdata-and-timezone-during-build/)
- [Serve PHP with PHP-FPM and NGINX](https://www.linode.com/docs/guides/serve-php-php-fpm-and-nginx/)

### –ó–∞–¥–∞–Ω–∏–µ

–ó–∞–¥–∞–Ω–∏—è –≤ –¥–∞–Ω–Ω–æ–º –º–æ–¥—É–ª–µ –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –º–µ–Ω—Ç–æ—Ä–æ–º –≤ –∫–æ–Ω—Ü–µ –º–æ–¥—É–ª—è.

–î–ª—è —Å–¥–∞—á–∏ –¥–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è —Å–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ ([–°–°–´–õ–ö–ê –ù–ê GitHub Classroom]).

–í —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–∫–∞—Ç—å –≤ –≥—É–≥–ª–µ –∏ –Ω–∞—É—á–∏—Ç—å—Å—è –∫–∞–∫ —Å–µ—Ä–≤–∏—Ç—å (–∞–Ω–≥–ª. "serve")
PHP –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ `php-fpm`. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é PHP.

1. –í—Å—è —Ä–∞–±–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ GitHub Classroom –≤ –ø–∞–ø–∫–µ `deploy-php`.
2. –ù–∞–ø–∏—Å–∞—Ç—å Dockerfile, –∫–æ—Ç–æ—Ä—ã–π:

   - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞ –æ—Å–Ω–æ–≤—É –æ–±—Ä–∞–∑ `ubuntu:18.04`;
   - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP-–ø—Ä–æ–µ–∫—Ç–∞:
     - –∫–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π [winter](https://github.com/wintercms/winter);
     - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: PHP, Composer, –∏ —Ç.–¥.
     - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ Composer;
     - üí° –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `config`, –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–∏—Ç–µ –Ω–∞ —Ñ–∞–π–ª `database.php`;
     - –ø—Ä–æ–≤–æ–¥–∏—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞;
     - –º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª `config/database.php` —Ç–∞–∫, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `sqlite`;
     - –Ω–∞–∫–∞—Ç—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏;
   - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx:
     - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é nginx mainline;
     - –∫–æ–ø–∏—Ä—É–µ—Ç `deploy-php.conf` –≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é;
   - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ `chmod` –∏ `chown`, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–≤—è–∑–∫—É `nginx+php`;
   - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤ `CMD` –∏ `ENTRYPOINT`.

3. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `deploy-php.conf` –¥–ª—è nginx, –∫–æ—Ç–æ—Ä—ã–π:

   - —Å–ª—É—à–∞–µ—Ç 80 –ø–æ—Ä—Ç;
   - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ PHP –ø—Ä–æ–µ–∫—Ç `winter`;

4. –ù–∞–ø–∏—Å–∞—Ç—å `docker-compose.yml`, –∫–æ—Ç–æ—Ä—ã–π:

   - –∏–º–µ–µ—Ç –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å `winter`;
   - —Å–µ—Ä–≤–∏—Å `winter` —Å–æ–±–∏—Ä–∞–µ—Ç —Å–±–æ—Ä–∫—É –∏–∑ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–ø—Ä–∏–º. `build`);
   - —Å–µ—Ä–≤–∏—Å `winter` –∏–º–µ–µ—Ç –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `deploy-php-winter`;
   - —Å–µ—Ä–≤–∏—Å `winter` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å —Ö–æ—Å—Ç–æ–≤–æ–≥–æ –ø–æ—Ä—Ç–∞ 80 –Ω–∞ 80 –ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞;
   - —Å–µ—Ä–≤–∏—Å `winter` –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–≤–∞–ª–∞;

5. –ó–∞–ø—É—Å—Ç–∏—Ç—å docker-compose.yml –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ [http://localhost](http://localhost). –î–æ–ª–∂–Ω–∞ –≤—ã–π—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç WinterCMS.
6. –ó–∞–ø—É—à–∏—Ç—å –≤ –≥–∏—Ç: `Dockerfile`, `docker-compose.yml`, `deploy-php.conf` –∏ –¥—Ä—É–≥–∏–µ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –¥–µ–±–∞–∂–∏—Ç—å (–∞–Ω–≥–ª. "debug" –≤ –ø–µ—Ä–µ–≤–æ–¥ "–æ—Ç–ª–∞–¥–∫–∞") —Å–æ–≤–µ—Ç—É–µ–º —Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–º:

- docker logs
- –ª–æ–≥–∏ nginx —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ access.log - `tail -f /var/log/nginx/access.log`
- –ª–æ–≥–∏ nginx –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ –≤ error.log - `tail -f /var/log/nginx/error.log`
- –ª–æ–≥–∏ –æ—Ç PHP –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

–û—à–∏–±–∫–∞ `Permission denied` –æ–∑–Ω–∞—á–∞–µ—Ç –æ—à–∏–±–∫—É –≤ –ø—Ä–∞–≤–∞—Ö –¥–æ—Å—Ç—É–ø–∞ –∏ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
–¥–æ—Å—Ç—É–ø —Å–µ—Ä–≤–∏—Å–∞ –∫ –Ω—É–∂–Ω—ã–º —Ñ–∞–π–ª–∞–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `chmod` –∏ `chown`.

–ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ —Å–≤–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º. –£ —Å–µ—Ä–≤–∏—Å–æ–≤ `nginx` –∏
`php-fpm` –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã.

---

### –û—Ç–≤–µ—Ç

- [Dockerfile](Dockerfile)
- [docker-compose.yml](docker-compose.yml)
- [deploy-php.conf](deploy-php.conf)
